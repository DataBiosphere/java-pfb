plugins {
    id 'com.srcclr.gradle'
    id 'maven-publish'
    id 'com.jfrog.artifactory'
    id 'bio.terra.pfb.java-library-conventions'
    id 'com.github.davidmc24.gradle.plugin.avro' version '1.8.0'
}

repositories {
    maven {
        // Terra proxy for maven central
        url 'https://broadinstitute.jfrog.io/broadinstitute/maven-central/'
    }
    mavenCentral()
    maven {
        url 'https://broadinstitute.jfrog.io/broadinstitute/libs-release/'
    }
    maven {
        url 'https://broadinstitute.jfrog.io/broadinstitute/libs-release-local/'
    }
}

dependencies {
    implementation 'ch.qos.logback:logback-classic:1.2.9'
    implementation "org.apache.avro:avro:1.11.2"
    implementation 'org.xerial.snappy:snappy-java:1.1.10.3'
    testImplementation 'org.json:json:20230618'
    testImplementation 'com.fasterxml.jackson.core:jackson-databind:2.15.2'
}

sourceSets.main.java.srcDirs += ["${buildDir}/generated-src"]
spotless {
    java{
        targetExclude "${buildDir}/**", "build/generated-src/**"
    }
}

generateAvroJava {
    source("library/src/main/avro")
    outputDir = file("build/generated-src")
}
compileJava.dependsOn generateAvroJava

apply from: 'generators.gradle'
apply from: "publishing.gradle"

srcclr {
    scope = "runtimeClasspath"
}

sourcesJar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

if (hasProperty('buildScan')) {
    buildScan {
        termsOfServiceUrl = 'https://gradle.com/terms-of-service'
        termsOfServiceAgree = 'yes'
    }
}